<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô ¬∑ JP Medical So Supply</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: "TH SarabunPSK", system-ui, sans-serif;
      margin: 0;
      padding: 8px;
      background: #f5f5f5;
    }
    .page {
      max-width: 1150px;
      margin: 0 auto;
      background: #fff;
      padding: 12px 18px 24px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .top-bar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
      flex-wrap:wrap;
    }
    .btn {
      padding:6px 14px;
      border-radius:30px;
      font-size:0.9rem;
      font-weight:600;
      cursor:pointer;
      border:none;
      color:#fff;
      box-shadow:0 2px 4px rgba(0,0,0,0.2);
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-back   { background:#607d8b; }
    .btn-print  { background:#ff9800; }

    /* header */
    .doc-header {
      display:flex;
      align-items:flex-start;
      gap:16px;
      border:1px solid #000;
      padding:8px 10px;
    }
    .logo-box img {
      max-width:110px;
      height:auto;
    }
    .header-main {
      flex:1;
      text-align:center;
      line-height:1.35;
    }
    .header-main h1 {
      margin:0;
      font-size:1.5rem;
      font-weight:bold;
    }
    .header-main .sub {
      font-size:1.05rem;
    }
    .branch-block {
      text-align:right;
      font-size:0.95rem;
      min-width:230px;
    }
    .branch-line {
      white-space:pre-line;
    }

    /* info rows */
    .info-row {
      display:flex;
      gap:8px;
      margin-top:6px;
    }
    .info-box {
      flex:1;
      border:1px solid #000;
      padding:6px 8px;
      font-size:0.95rem;
    }
    .info-title {
      font-weight:bold;
      margin-bottom:4px;
    }
    .info-grid {
      display:grid;
      grid-template-columns:110px 1fr;
      row-gap:2px;
    }
    .info-grid label {
      display:block;
    }
    .info-grid input {
      width:100%;
      border:none;
      border-bottom:1px dotted #555;
      font-family:inherit;
      font-size:0.95rem;
      padding:0 2px;
      outline:none;
    }

    .meta-grid {
      display:grid;
      grid-template-columns:120px 1fr;
      row-gap:2px;
    }
    .meta-grid input {
      width:100%;
      border:none;
      border-bottom:1px dotted #555;
      font-family:inherit;
      font-size:0.95rem;
      padding:0 2px;
      outline:none;
    }

    /* table */
    .table-wrapper {
      margin-top:8px;
      border:1px solid #000;
      border-top:none;
    }
    table {
      width:100%;
      border-collapse:collapse;
      font-size:0.95rem;
    }
    th, td {
      border:1px solid #000;
      padding:2px 4px;
      vertical-align:top;
    }
    thead th {
      text-align:center;
      background:#2196f3;
      color:#fff;
    }
    .number-cell { text-align:center; width:40px; }
    .itemcode-cell { width:130px; }
    .desc-cell { width:320px; }
    .qty-cell { width:70px; text-align:center; }
    .unit-cell { width:80px; text-align:center; }
    .price-cell { width:110px; text-align:right; }
    .amount-cell { width:120px; text-align:right; }

    .cell-input {
      width:100%;
      border:none;
      font-family:inherit;
      font-size:0.95rem;
      padding:0 2px;
      box-sizing:border-box;
      outline:none;
    }
    .cell-input.number { text-align:right; }
    .cell-input.center { text-align:center; }

    /* summary */
    .summary-row {
      display:flex;
      border-left:1px solid #000;
      border-right:1px solid #000;
      border-bottom:1px solid #000;
    }
    .summary-left {
      flex:1;
      border-right:1px solid #000;
      min-height:70px;
      padding:4px 6px;
      font-size:1rem;
    }
    .summary-left span[contenteditable] {
      border-bottom:1px dotted #555;
      padding:0 4px;
      min-width:120px;
      display:inline-block;
    }
    .summary-right {
      width:230px;
    }
    .summary-right table {
      width:100%;
      border-collapse:collapse;
      font-size:0.95rem;
    }
    .summary-right td {
      border-left:1px solid #000;
      border-right:1px solid #000;
      border-bottom:1px solid #000;
      padding:2px 4px;
    }
    .summary-right .label { width:55%; }
    .summary-right .value { width:45%; text-align:right; }
    .summary-right input {
      border:none;
      width:100%;
      text-align:right;
      font-family:inherit;
      font-size:0.95rem;
      outline:none;
    }

    /* sign */
    .footer-block {
      border:1px solid #000;
      border-top:none;
      padding:8px 10px 12px;
      font-size:0.95rem;
      display:grid;
      grid-template-columns:1.4fr 1fr;
      gap:8px;
    }
    .footer-left {
      border-right:1px solid #000;
      padding-right:10px;
    }
    .footer-left p {
      margin:2px 0;
    }
    .footer-sign-row {
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
    }
    .sign-box {
      flex:1;
      text-align:center;
    }
    .sign-line {
      border-bottom:1px solid #000;
      height:26px;
      margin-bottom:2px;
    }
    .footer-right {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:space-between;
      text-align:center;
      gap:6px;
    }
    .footer-right img {
      max-width:120px;
      height:auto;
    }
    .footer-note {
      font-size:0.8rem;
      color:#555;
    }

    .status-text {
      font-size:0.8rem;
      color:#777;
      margin-top:4px;
    }

    @media print {
      body { background:#fff; padding:0; }
      .page { box-shadow:none; margin:0; padding:0 5mm 5mm; }
      .top-bar { display:none; }
      .status-text { display:none; }
      @page { size:A4 portrait; margin:5mm; }
    }
  </style>
</head>
<body>
<div class="page">

  <div class="top-bar">
    <a href="./‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤.html" class="btn btn-back">‚Üê ‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</a>
    <button class="btn btn-print" onclick="window.print()">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå / PDF</button>
  </div>

  <!-- HEADER -->
  <div class="doc-header">
    <div class="logo-box">
      <img src="./LOGO.jpg" alt="JP Medical So Supply Logo">
    </div>
    <div class="header-main">
      <h1>RECEIPT</h1>
      <div class="sub">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</div>
    </div>
    <div class="branch-block">
      <div><strong>‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå JP Medical So Supply</strong></div>
      <div id="branchInfo" class="branch-line"></div>
    </div>
  </div>

  <!-- CUSTOMER + META -->
  <div class="info-row">
    <div class="info-box">
      <div class="info-title">‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Customer)</div>
      <div class="info-grid">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏£‡∏∞:</label>
        <input id="rcCustName" type="text" />
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏£‡πâ‡∏≤‡∏ô:</label>
        <input id="rcCustOrg" type="text" />
        <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</label>
        <input id="rcCustAddr" type="text" />
        <label>‡πÇ‡∏ó‡∏£:</label>
        <input id="rcCustTel" type="text" />
      </div>
    </div>
    <div class="info-box">
      <div class="info-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</div>
      <div class="meta-grid">
        <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à:</label>
        <input id="receiptNo" type="text" />
        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
        <input id="receiptDate" type="text" />
        <label>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤:</label>
        <input id="refQuoteNo" type="text" />
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-wrapper">
    <table>
      <thead>
      <tr>
        <th class="number-cell">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
        <th class="itemcode-cell">Item Code</th>
        <th class="desc-cell">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
        <th class="qty-cell">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
        <th class="unit-cell">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th class="price-cell">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th class="amount-cell">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
      </tr>
      </thead>
      <tbody id="rcItemBody"></tbody>
    </table>
  </div>

  <!-- SUMMARY -->
  <div class="summary-row">
    <div class="summary-left">
      ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£):
      <span id="rcAmountWords" contenteditable="true">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô</span>
      <br>
      ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:
      <span id="rcPayMethod" contenteditable="true">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</span>
    </div>
    <div class="summary-right">
      <table>
        <tr>
          <td class="label">‡∏¢‡∏≠‡∏î‡∏ï‡∏≤‡∏°‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</td>
          <td class="value">
            <input id="rcQuoteTotal" type="text" value="0.00" readonly>
          </td>
        </tr>
        <tr>
          <td class="label"><strong>‡∏¢‡∏≠‡∏î‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ</strong></td>
          <td class="value">
            <input id="rcPaid" type="text" value="0.00">
          </td>
        </tr>
      </table>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer-block">
    <div class="footer-left">
      <p>‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô‡πÑ‡∏ß‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</p>
      <p>This is to certify that the above amount has been received in full.</p>

      <div class="footer-sign-row">
        <div class="sign-box">
          <div class="sign-line"></div>
          ( .................................................. )<br>
          ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô
        </div>
        <div class="sign-box">
          <div class="sign-line"></div>
          ( ‡∏û‡∏±‡∏í‡∏ô‡πå‡∏ô‡∏£‡∏µ ‡πÇ‡∏û‡∏ò‡∏¥‡∏£‡∏≤‡∏ä )<br>
          ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ / Prepared by
        </div>
      </div>
    </div>
    <div class="footer-right">
      <div>‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏ö‡∏û‡∏£‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£<br>JP Medical So Supply</div>
      <img src="./ORCODE%20OFFice.png" alt="Line QR">
      <div class="footer-note">
        ‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå / ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°
      </div>
    </div>
  </div>

  <div id="status" class="status-text">
    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‚Ä¶
  </div>
</div>

<script>
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏ß‡πà‡∏≤‡∏á 10 ‡πÅ‡∏ñ‡∏ß
  function buildReceiptRows() {
    const tbody = document.getElementById("rcItemBody");
    tbody.innerHTML = "";
    for (let i = 0; i < 10; i++) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="number-cell">
          <span>${i+1}</span>
        </td>
        <td class="itemcode-cell">
          <input class="cell-input" id="rcCode_${i}" type="text">
        </td>
        <td class="desc-cell">
          <input class="cell-input" id="rcDesc_${i}" type="text">
        </td>
        <td class="qty-cell">
          <input class="cell-input center" id="rcQty_${i}" type="number" min="0" step="1">
        </td>
        <td class="unit-cell">
          <input class="cell-input center" id="rcUnit_${i}" type="text">
        </td>
        <td class="price-cell">
          <input class="cell-input number" id="rcPrice_${i}" type="number" step="0.01">
        </td>
        <td class="amount-cell">
          <input class="cell-input number" id="rcAmount_${i}" type="number" step="0.01">
        </td>
      `;
      tbody.appendChild(tr);
    }
  }

  function fmtThaiDate(date) {
    const dd = String(date.getDate()).padStart(2, "0");
    const mm = String(date.getMonth()+1).padStart(2, "0");
    const yy = date.getFullYear() + 543;
    return `${dd}/${mm}/${yy}`;
  }

  function initReceiptNoAndDate() {
    let seq = parseInt(localStorage.getItem("JP_RC_SEQ") || "0", 10);
    seq++;
    localStorage.setItem("JP_RC_SEQ", String(seq).padStart(4, "0"));
    const seqStr = String(seq).padStart(4, "0");

    document.getElementById("receiptNo").value = `RC-${seqStr}`;
    document.getElementById("receiptDate").value = fmtThaiDate(new Date());
  }

  function fillFromQuoteData(data) {
    const status = document.getElementById("status");

    // ‡∏™‡∏≤‡∏Ç‡∏≤
    if (data.branch && data.branch.infoText) {
      document.getElementById("branchInfo").textContent = data.branch.infoText;
    }

    // ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    if (data.customer) {
      document.getElementById("rcCustName").value = data.customer.name || "";
      document.getElementById("rcCustOrg").value  = data.customer.org  || "";
      document.getElementById("rcCustAddr").value = data.customer.addr || "";
      document.getElementById("rcCustTel").value  = data.customer.tel  || "";
    }

    // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤
    if (data.quoteMeta) {
      document.getElementById("refQuoteNo").value = data.quoteMeta.quoteNo || "";
    }

    // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
    if (Array.isArray(data.items)) {
      data.items.forEach((item, idx) => {
        if (idx >= 10) return; // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÅ‡∏Ñ‡πà 10 ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤
        document.getElementById(`rcCode_${idx}`).value   = item.code   || "";
        document.getElementById(`rcDesc_${idx}`).value   = item.desc   || "";
        document.getElementById(`rcQty_${idx}`).value    = item.qty    || "";
        document.getElementById(`rcUnit_${idx}`).value   = item.unit   || "";
        document.getElementById(`rcPrice_${idx}`).value  = item.price  || "";
        document.getElementById(`rcAmount_${idx}`).value = item.amount || "";
      });
    }

    // ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô
    if (data.totals) {
      document.getElementById("rcQuoteTotal").value = data.totals.grand || "0.00";
      document.getElementById("rcPaid").value       = data.totals.grand || "0.00";
      document.getElementById("rcAmountWords").textContent =
        data.totals.words || "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";
    }

    status.textContent = "‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß";
  }

  document.addEventListener("DOMContentLoaded", () => {
    buildReceiptRows();
    initReceiptNoAndDate();

    const status = document.getElementById("status");
    try {
      const raw = localStorage.getItem("JP_QUOTE_TO_RECEIPT");
      if (!raw) {
        status.textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤ (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á)";
        return;
      }
      const data = JSON.parse(raw);
      fillFromQuoteData(data);
      // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á:
      // localStorage.removeItem("JP_QUOTE_TO_RECEIPT");
    } catch (e) {
      console.error(e);
      status.textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡πÑ‡∏î‡πâ";
    }
  });
</script>
</body>
</html>
