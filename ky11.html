<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏¢‡∏≤ (‡∏Ç‡∏¢.11)</title>

  <style>
    body {
      font-family: "TH SarabunPSK", system-ui, sans-serif;
      margin: 0;
      padding: 16px;
      background: #f5f5f5;
    }

    .page {
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      padding: 16px 24px 32px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
    .top-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .btn {
      padding: 8px 16px;
      border-radius: 30px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      text-decoration: none;
    }
    .btn-ky9-list { background:#00c853; }
    .btn-ky9-form { background:#009688; }
    .btn-ky11    { background:#1976d2; }
    .btn-print   { background:#ff9800; }
    .btn-download{ background:#9c27b0; }

    .top-row {
      display:flex;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-bottom:8px;
    }
    .status {
      font-size:0.85rem;
      color:#777;
    }

    .lot-box {
      font-size:0.9rem;
    }
    .lot-box select {
      padding:4px 8px;
      border-radius:6px;
      border:1px solid #ccc;
      min-width:240px;
    }

    .table-wrapper {
      border:3px solid #00c853;
    }
    table {
      width:100%;
      border-collapse:collapse;
      font-size:0.9rem;
    }
    th, td {
      border:1px solid #555;
      padding:4px;
      white-space:nowrap;
      vertical-align:top;
    }

    /* ‡∏´‡∏±‡∏ß‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ô thead */
    .title-row th {
      border:none;
      text-align:center;
      font-size:1.3rem;
      padding-top:8px;
      padding-bottom:0;
    }
    .shop-row th {
      border:none;
      text-align:center;
      font-size:1.1rem;
      padding-top:0;
      padding-bottom:0;
    }
    .addr-row th {
      border:none;
      text-align:center;
      font-size:0.95rem;
      padding:4px 0;
    }
    .label-row th {
      border:none;
      font-size:0.9rem;
      padding-top:4px;
      padding-bottom:2px;
    }
    .label-row th:first-child { text-align:left; }
    .label-row th:last-child  { text-align:right; }

    .info-top-row th {
      font-size:0.9rem;
      padding-top:4px;
      padding-bottom:4px;
    }
    .info-left,
    .info-mid,
    .info-right {
      text-align:left;
    }

    .editable {
      border-bottom:1px dotted #555;
      padding:0 2px;
      min-width:80px;
      display:inline-block;
    }

    /* ‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≤‡∏¢ */
    .header-row th {
      background:#00c853;
      color:#fff;
      text-align:center;
    }
    .header-row th:nth-child(1),
    tbody td:nth-child(1) { width:40px;  text-align:center; }
    .header-row th:nth-child(2),
    tbody td:nth-child(2) { width:90px;  text-align:center; }
    .header-row th:nth-child(3),
    tbody td:nth-child(3) { width:120px; text-align:center; }
    .header-row th:nth-child(4),
    tbody td:nth-child(4) { width:220px; }
    .header-row th:nth-child(5),
    tbody td:nth-child(5) { width:160px; }
    .header-row th:nth-child(6),
    tbody td:nth-child(6) { width:100px; }

    @media print {
      body {
        padding:0;
        background:white;
      }
      .page {
        box-shadow:none;
        margin:0;
        padding:0 8mm;
      }
      .top-buttons,
      .top-row { display:none; }

      thead { display: table-header-group; }
      tfoot { display: table-footer-group; }
    }
  </style>
</head>

<body>
<div class="page">

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô -->
  <div class="top-buttons">
    <a href="./ky9.html" class="btn btn-ky9-list">‡∏Ç‡∏¢.9 (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö)</a>
    <a href="./ky9-form.html" class="btn btn-ky9-form">‡∏Ç‡∏¢.9 (‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°)</a>
    <a href="./ky11.html" class="btn btn-ky11">‡∏Ç‡∏¢.11 (‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏¢‡∏≤)</a>
    <button class="btn btn-print" onclick="window.print()">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
    <button class="btn btn-download" onclick="window.print()">‚¨á PDF</button>
  </div>

  <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å LOT -->
  <div class="top-row">
    <div class="lot-box">
      LOT:
      <select id="lotSelect">
        <option value="">--- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å LOT / ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤ ---</option>
      </select>
    </div>
    <div id="status" class="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• LOT ‡∏à‡∏≤‡∏Å ‡∏Ç‡∏¢.9 ‚Ä¶</div>
  </div>

  <div class="table-wrapper">
    <table>
      <thead>
        <!-- ‡∏´‡∏±‡∏ß‡∏ü‡∏≠‡∏£‡πå‡∏° (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô Excel) -->
        <tr class="title-row">
          <th colspan="6">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏¢‡∏≤‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏Ç‡∏Ç‡∏≤‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î</th>
        </tr>
        <tr class="shop-row">
          <th colspan="6">‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏¢‡∏≤ <span class="editable" contenteditable="true">‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤‡∏î‡∏µ‡∏î‡∏µ</span></th>
        </tr>
        <tr class="addr-row">
          <th colspan="6">
            ‡πÅ‡∏™‡∏ô‡∏™‡∏∏‡∏Ç
            <span class="editable" contenteditable="true">
              123 ‡∏ñ‡∏ô‡∏ô ‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏•‡∏≤‡∏° ‡∏ï‡∏≥‡∏ö‡∏• ‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏∂‡∏Å ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ 20000 ‡πÇ‡∏ó‡∏£. 098 444 1614
            </span>
          </th>
        </tr>
        <tr class="label-row">
          <th colspan="6">
            <span style="float:right;">‡πÅ‡∏ö‡∏ö ‡∏Ç‡∏¢.11</span>
          </th>
        </tr>

        <!-- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤ (3 ‡∏Å‡∏•‡πà‡∏≠‡∏á: ‡∏ã‡πâ‡∏≤‡∏¢/‡∏Å‡∏•‡∏≤‡∏á/‡∏Ç‡∏ß‡∏≤) -->
        <tr class="info-top-row">
          <th colspan="2" class="info-left">
            ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤.......<span id="drugNameDisplay" style="font-weight:bold;"></span><br>
            ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï/‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤...............<span id="producerDisplay"></span><br>
            ‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å.......<span id="fromDisplay"></span>
          </th>
          <th colspan="2" class="info-mid">
            ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï.....<span id="lotDisplay" style="font-weight:bold;"></span><br>
            ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏±‡∏ö........<span id="qtyDisplay"></span>
            <span id="unitDisplay"></span>
          </th>
          <th colspan="2" class="info-right">
            ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏£‡∏£‡∏à‡∏∏...............................<br>
            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö........<span id="dateInDisplay"></span>
          </th>
        </tr>

        <!-- ‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≤‡∏¢ -->
        <tr class="header-row">
          <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà</th>
          <th>‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ</th>
          <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô / ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì ‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏• ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠</th>
          <th>‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£</th>
          <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
        </tr>
      </thead>

      <tbody id="saleBody">
        <!-- ‡πÅ‡∏ñ‡∏ß‡∏Ç‡∏≤‡∏¢‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JS -->
      </tbody>
    </table>
  </div>
</div>

<script>
const SPREADSHEET_ID ="1Fqq6zxoM8Qw-hNbl5U7hwmezdzxT32ek43qX70uQAZc";
const GID ="136320859";
const URL =`https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json&gid=${GID}`;

let ky9Rows = [];

function getQueryParam(name){
  const params=new URLSearchParams(window.location.search);
  return params.get(name);
}

async function loadLots(){
  const status=document.getElementById("status");
  const select=document.getElementById("lotSelect");

  try{
    const res=await fetch(URL);
    const text=await res.text();
    const jsonStr=text.substring(text.indexOf("{"), text.lastIndexOf("}")+1);
    const data=JSON.parse(jsonStr);
    ky9Rows=data.table.rows || [];

    ky9Rows.forEach(row=>{
      const c=row.c||[];
      const lot=c[5]?.v || "";
      const drug=c[4]?.v || "";
      const vendor=c[2]?.v || "";
      if(!lot || !drug) return;

      const opt=document.createElement("option");
      opt.value=lot;
      opt.textContent=`${lot} ‚Äì ${drug} (${vendor})`;
      select.appendChild(opt);
    });

    status.textContent="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å LOT ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏Ç‡∏¢.11";

    const lotFromUrl=getQueryParam("lot");
    if(lotFromUrl){
      const found = Array.from(select.options)
        .find(o=>o.value.toString()===lotFromUrl.toString());
      if(found){
        select.value=lotFromUrl;
        applyLot(lotFromUrl);
      }
    }
  }catch(e){
    console.error(e);
    status.textContent="‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• LOT ‡∏à‡∏≤‡∏Å ‡∏Ç‡∏¢.9 ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
  }

  select.addEventListener("change",()=>{
    const lot=select.value;
    if(lot){
      applyLot(lot);
    }
  });
}

function applyLot(lot){
  const status=document.getElementById("status");
  const row = ky9Rows.find(r => (r.c[5]?.v || "").toString() === lot.toString());

  if(!row){
    status.textContent="‡πÑ‡∏°‡πà‡∏û‡∏ö LOT ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô ‡∏Ç‡∏¢.9";
    return;
  }

  const c=row.c || [];
  const dateIn = c[1]?.f || c[1]?.v || "";
  const vendor = c[2]?.v || "";
  const drug   = c[4]?.v || "";
  const qty    = c[6]?.v || "";
  const unit   = c[7]?.v || "";

  // ‡πÄ‡∏ï‡∏¥‡∏°‡∏´‡∏±‡∏ß‡∏ü‡∏≠‡∏£‡πå‡∏°
  document.getElementById("drugNameDisplay").textContent = drug;
  document.getElementById("lotDisplay").textContent      = lot;
  document.getElementById("producerDisplay").textContent = vendor;
  document.getElementById("fromDisplay").textContent     = vendor;
  document.getElementById("qtyDisplay").textContent      = qty || "";
  document.getElementById("unitDisplay").textContent     = unit || "";
  document.getElementById("dateInDisplay").textContent   = dateIn;

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏Ç‡∏≤‡∏¢: ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 40 ‡πÅ‡∏ñ‡∏ß
  const saleBody=document.getElementById("saleBody");
  saleBody.innerHTML="";
  const numRows = Math.min(parseInt(qty || "0",10) || 15, 40);

  for(let i=1;i<=numRows;i++){
    const tr=document.createElement("tr");

    function cell(text, center=false){
      const td=document.createElement("td");
      td.textContent=text;
      if(center) td.style.textAlign="center";
      tr.appendChild(td);
    }

    cell(i,true);   // ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà
    cell("");       // ‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ ‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢
    cell("");       // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô/‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì ‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏¢
    cell("");       // ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠
    cell("");       // ‡∏•‡∏≤‡∏¢‡∏°‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£
    cell("");       // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

    saleBody.appendChild(tr);
  }

  status.textContent=`‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° ‡∏Ç‡∏¢.11 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LOT ${lot} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`;
}

loadLots();
</script>

</body>
</html>
