<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ¬∑ JP Medical So Supply</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: "TH SarabunPSK", system-ui, sans-serif;
      margin: 0;
      padding: 8px;
      background: #f5f5f5;
    }
    .page {
      max-width: 1150px;
      margin: 0 auto;
      background: #fff;
      padding: 12px 18px 24px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    /* top bar */
    .top-bar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
      flex-wrap:wrap;
    }
    .btn {
      padding:6px 14px;
      border-radius:30px;
      font-size:0.9rem;
      font-weight:600;
      cursor:pointer;
      border:none;
      color:#fff;
      box-shadow:0 2px 4px rgba(0,0,0,0.2);
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-back    { background:#607d8b; }
    .btn-print   { background:#ff9800; }
    .btn-receipt { background:#4caf50; }

    /* language switch */
    .lang-switch {
      display:flex;
      gap:4px;
    }
    .btn-lang {
      border-radius:16px;
      border:1px solid #ccc;
      background:#fff;
      color:#333;
      font-size:0.8rem;
      padding:4px 10px;
      cursor:pointer;
    }
    .btn-lang.active {
      background:#00c853;
      color:#fff;
      border-color:#00c853;
    }

    /* header logo + branch */
    .doc-header {
      display:flex;
      align-items:flex-start;
      gap:16px;
      border:1px solid #000;
      padding:8px 10px;
    }
    .logo-box img {
      max-width:110px;
      height:auto;
    }
    .header-main {
      flex:1;
      text-align:center;
      line-height:1.35;
    }
    .header-main h1 {
      margin:0;
      font-size:1.5rem;
      font-weight:bold;
    }
    .header-main .sub {
      font-size:1.05rem;
    }
    .branch-block {
      text-align:right;
      font-size:0.95rem;
      min-width:230px;
    }
    .branch-line {
      white-space:pre-line;
    }
    .branch-select-row {
      margin-top:4px;
      display:flex;
      justify-content:flex-end;
      gap:4px;
      align-items:center;
      font-size:0.9rem;
    }
    .branch-select-row select {
      font-family:inherit;
      font-size:0.9rem;
      padding:2px 6px;
    }

    /* info rows */
    .info-row {
      display:flex;
      gap:8px;
      margin-top:6px;
    }
    .info-box {
      flex:1;
      border:1px solid #000;
      padding:6px 8px;
      font-size:0.95rem;
    }
    .info-title {
      font-weight:bold;
      margin-bottom:4px;
    }
    .info-grid {
      display:grid;
      grid-template-columns:110px 1fr;
      row-gap:2px;
    }
    .info-grid label {
      display:block;
    }
    .info-grid input {
      width:100%;
      border:none;
      border-bottom:1px dotted #555;
      font-family:inherit;
      font-size:0.95rem;
      padding:0 2px;
      outline:none;
    }

    /* quote meta */
    .meta-grid {
      display:grid;
      grid-template-columns:120px 1fr;
      row-gap:2px;
    }
    .meta-grid input {
      width:100%;
      border:none;
      border-bottom:1px dotted #555;
      font-family:inherit;
      font-size:0.95rem;
      padding:0 2px;
      outline:none;
    }

    /* table */
    .table-wrapper {
      margin-top:8px;
      border:1px solid #000;
      border-top:none;
    }
    table {
      width:100%;
      border-collapse:collapse;
      font-size:0.95rem;
    }
    th, td {
      border:1px solid #000;
      padding:2px 4px;
      vertical-align:top;
    }
    thead th {
      text-align:center;
      background:#00c853;
      color:#fff;
    }
    .number-cell { text-align:center; width:40px; }
    .itemcode-cell { width:130px; }
    .desc-cell   { width:320px; }
    .qty-cell    { width:70px;  text-align:center; }
    .unit-cell   { width:80px;  text-align:center; }
    .price-cell  { width:110px; text-align:right; }
    .amount-cell { width:120px; text-align:right; }

    .cell-input {
      width:100%;
      border:none;
      font-family:inherit;
      font-size:0.95rem;
      padding:0 2px;
      box-sizing:border-box;
      outline:none;
    }
    .cell-input.number { text-align:right; }
    .cell-input.center { text-align:center; }

    .desc-print {
      display:none;
      white-space:normal;
      line-height:1.1;
      max-height:2.4em;
      overflow:hidden;
    }

    .summary-row {
      display:flex;
      border-left:1px solid #000;
      border-right:1px solid #000;
      border-bottom:1px solid #000;
    }
    .summary-left {
      flex:1;
      border-right:1px solid #000;
      min-height:90px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.2rem;
    }

    .summary-right {
      width:230px;
    }

    /* footer */
    .footer-block {
      border:1px solid #000;
      border-top:none;
      padding:8px 10px 12px;
      font-size:0.95rem;
      display:grid;
      grid-template-columns:1.4fr 1fr;
      gap:8px;
    }

    #printContainer {
      display:none;
    }

    @media print {
      body { background:#fff; padding:0; }
      #editPage { display:none; }
      #printContainer { display:block; }
      .top-bar { display:none; }
      .page { box-shadow:none; margin:0; padding:0 5mm 5mm; }
      .print-page { page-break-after:always; }
      .print-page:last-child { page-break-after:auto; }
      @page { size:A4 portrait; margin:5mm; }

      input::placeholder { color: transparent; }

      input[id^="desc_"] { display:none; }
      .desc-print { display:block; }

      .table-wrapper table thead th {
        border-top:1px solid #000;
        border-bottom:1px solid #000;
        border-left:1px solid #000;
        border-right:1px solid #000;
      }
      .table-wrapper table tbody td {
        border-top:none;
        border-bottom:none;
        border-left:1px solid #000;
        border-right:1px solid #000;
      }
      .table-wrapper table tbody tr:last-child td {
        border-bottom:1px solid #000;
      }
    }
  </style>
</head>

<body>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å -->
<div class="page" id="editPage">
    <div class="top-bar">
    <a href="./ky9.html" class="btn btn-back" data-i18n="btn_back_ky9">‚Üê ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏Ç‡∏¢.9)</a>

    <div class="lang-switch">
      <button type="button" class="btn-lang" data-lang="th">TH</button>
      <button type="button" class="btn-lang" data-lang="en">EN</button>
    </div>

    <a href="./Receipt%20Form.html" id="btnReceipt" class="btn btn-receipt">
      üßæ <span data-i18n="btn_receipt">‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</span>
    </a>

    <button class="btn btn-print" onclick="window.print()">üñ® <span data-i18n="btn_print">‡∏û‡∏¥‡∏°‡∏û‡πå / PDF</span></button>
  </div>

  <div class="doc-header">
    <div class="logo-box">
      <img src="./LOGO.jpg" alt="JP Medical So Supply Logo">
    </div>
    <div class="header-main">
      <h1 data-i18n="title_quotation">QUOTATION</h1>
      <div class="sub" data-i18n="subtitle_quotation">‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</div>
    </div>
    <div class="branch-block">
      <div><strong>‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå JP Medical So Supply</strong></div>
      <div id="branchInfo" class="branch-line"></div>
      <div class="branch-select-row">
        <label for="branchSelect" data-i18n="label_branch">‡∏™‡∏≤‡∏Ç:</label>
        <select id="branchSelect">
          <option value="ssk" data-i18n="branch_ssk">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà (‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©)</option>
          <option value="chon" data-i18n="branch_chon">‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ</option>
        </select>
      </div>
    </div>
  </div>

  <div class="info-row">
    <div class="info-box">
      <div class="info-title" data-i18n="box_customer">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Customer)</div>
      <div class="info-grid">
        <label data-i18n="label_customer_name">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö:</label>
        <input id="custName" type="text" />
        <label data-i18n="label_org">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏£‡πâ‡∏≤‡∏ô:</label>
        <input id="custOrg" type="text" />
        <label data-i18n="label_address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</label>
        <input id="custAddr" type="text" />
        <label data-i18n="label_tel">‡πÇ‡∏ó‡∏£:</label>
        <input id="custTel" type="text" />
      </div>
    </div>

    <div class="info-box">
      <div class="info-title" data-i18n="box_quote_detail">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</div>
      <div class="meta-grid">
        <label data-i18n="label_quote_no">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤:</label>
        <input id="quoteNo" type="text" />
        <label data-i18n="label_quote_date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
        <input id="quoteDate" type="text" />
        <label data-i18n="label_valid_until">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
        <input id="validUntil" type="text" />
        <label data-i18n="label_contact">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</label>
        <input id="contactName" type="text" />
        <label data-i18n="label_contact_tel">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</label>
        <input id="contactTel" type="text" />
      </div>
    </div>
  </div>

  <div class="table-wrapper">
    <table>
      <thead>
      <tr>
        <th class="number-cell" data-i18n="th_no">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
        <th class="itemcode-cell" data-i18n="th_itemcode">Item Code</th>
        <th class="desc-cell" data-i18n="th_desc">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
        <th class="qty-cell" data-i18n="th_qty">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
        <th class="unit-cell" data-i18n="th_unit">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th class="price-cell" data-i18n="th_price">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th class="amount-cell" data-i18n="th_amount">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
      </tr>
      </thead>
      <tbody id="itemBody"></tbody>
    </table>
  </div>

  <div class="summary-row">
    <div class="summary-left">
      <span data-i18n="summary_amount_words">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£):</span>
      &nbsp;
      <span id="amountWords" contenteditable="true">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô</span>
    </div>
    <div class="summary-right">
      <div class="vat-toggle-row">
        <label>
          <input type="checkbox" id="chkVat" checked>
          <span data-i18n="vat_toggle_label">‡∏Ñ‡∏¥‡∏î‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° 7%</span>
        </label>
      </div>
      <table>
        <tr>
          <td class="label" data-i18n="summary_subtotal">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td>
          <td class="value">
            <input id="sumSubTotal" type="text" value="0.00" readonly>
          </td>
        </tr>
        <tr>
          <td class="label" data-i18n="summary_discount">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td>
          <td class="value">
            <input id="sumDiscount" type="text" value="0.00">
          </td>
        </tr>
        <tr>
          <td class="label" data-i18n="summary_vat">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° 7.00%</td>
          <td class="value">
            <input id="sumVat" type="text" value="0.00" readonly>
          </td>
        </tr>
        <tr>
          <td class="label" data-i18n="summary_deposit">‡∏´‡∏±‡∏Å ‡∏°‡∏±‡∏î‡∏à‡∏≥/‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</td>
          <td class="value">
            <input id="sumDeposit" type="text" value="0.00">
          </td>
        </tr>
        <tr>
          <td class="label"><strong data-i18n="summary_grand">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</strong></td>
          <td class="value">
            <input id="sumGrand" type="text" value="0.00" readonly>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <div class="footer-block">
    <div class="footer-left">
      <p data-i18n="sign_please_th">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ</p>
      <p data-i18n="sign_please_en">Please sign below purchasing confirmation.</p>

      <div class="footer-sign-row">
        <div class="sign-box">
          <div class="sign-line"></div>
          ( <span id="buyerName" contenteditable="true"></span> )<br>
          <span data-i18n="label_buyer">‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</span>
        </div>
        <div class="sign-box">
          <div class="sign-line"></div>
          ( ‡∏û‡∏±‡∏í‡∏ô‡πå‡∏ô‡∏£‡∏µ ‡πÇ‡∏û‡∏ò‡∏¥‡∏£‡∏±‡∏ï‡∏ô‡πå )<br>
          <span data-i18n="label_prepared_by">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ / Prepared by</span>
        </div>
      </div>
    </div>

    <div class="footer-right">
      <div data-i18n="respectfully">
        ‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏∑‡∏≠<br>JP Medical So Supply
      </div>
      <img src="./ORCODE%20OFFice.png" alt="Line QR">
      <div class="footer-note" data-i18n="footer_note">
        ‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå / ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°
      </div>
    </div>
  </div>

  <div id="status" class="status-text">
    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏à‡∏≤‡∏Å Google Sheet‚Ä¶
  </div>

  <div class="page-number"></div>
</div>

<!-- PRINT MULTI PAGE -->
<div id="printContainer"></div>

<datalist id="productList"></datalist>

<script>
  // ============================
  // MULTI-PAGE PRINT (FIX BRANCH)
  // ============================
  function syncInputAttributes() {
    document.querySelectorAll("#editPage input").forEach(inp => {
      inp.setAttribute("value", inp.value);
    });
  }

  function buildPrintPages() {
    recalcTotals();
    syncAllDescPrint();
    syncInputAttributes();

    const printContainer = document.getElementById("printContainer");
    printContainer.innerHTML = "";

    const editPage = document.getElementById("editPage");
    if (!editPage) return;

    // ============================
    // FIX: sync ‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    // ============================
    const selectedBranch = document.getElementById("branchSelect").value;

    // ‡∏´‡∏≤ row ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
    let lastRow = -1;
    for (let i = 0; i < MAX_ROWS; i++) {
      const code = (document.getElementById(`code_${i}`).value || "").trim();
      const desc = (document.getElementById(`desc_${i}`).value || "").trim();
      const amt  = (document.getElementById(`amount_${i}`).value || "").trim();
      if (code || desc || amt) lastRow = i;
    }
    if (lastRow < 0) lastRow = 0;

    const totalItems = lastRow + 1;
    const totalPages = Math.max(1, Math.ceil(totalItems / PAGE_SIZE));
    const dict = I18N[currentLang] || I18N.th;
    const pagePrefix = dict.page_prefix || "";

    for (let p = 0; p < totalPages; p++) {
      const clone = editPage.cloneNode(true);
      clone.id = "";
      clone.classList.add("print-page");

      // ====================================
      // FIX: sync dropdown ‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏ô clone
      // ====================================
      const cloneBranchSelect = clone.querySelector("#branchSelect");
      if (cloneBranchSelect) {
        cloneBranchSelect.value = selectedBranch;
      }

      // ====================================
      // FIX: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏Ç‡∏≤
      // ====================================
      const cloneBranchInfo = clone.querySelector("#branchInfo");
      if (cloneBranchInfo) {
        if (selectedBranch === "chon") {
          cloneBranchInfo.textContent =
            "‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡πÄ‡∏à‡∏û‡∏µ ‡πÄ‡∏°‡∏î‡∏¥‡∏Ñ‡∏≠‡∏• ‡πÇ‡∏ã ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢ (‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ)\n" +
            "‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 51/49 ‡∏ñ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó ‡∏´‡∏°‡∏π‡πà 4 ‡∏ï‡∏≥‡∏ö‡∏•‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏ß‡∏ô ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ 20000\n" +
            "‡πÇ‡∏ó‡∏£ 090-413-7894, 090-967-4207";
        } else {
          cloneBranchInfo.textContent =
            "‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡πÄ‡∏à‡∏û‡∏µ ‡πÄ‡∏°‡∏î‡∏¥‡∏Ñ‡∏≠‡∏• ‡πÇ‡∏ã ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢ (‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà)\n" +
            "‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 871/1 ‡∏ñ‡∏ô‡∏ô‡∏≠‡∏∏‡∏ö‡∏• ‡∏ï‡∏≥‡∏ö‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÉ‡∏ï‡πâ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏© 33000\n" +
            "‡πÇ‡∏ó‡∏£ 090-413-7894, 090-967-4207";
        }
      }
      // ===== END FIX =====

      // ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      const tbody = clone.querySelector("#itemBody");
      const rows = tbody.querySelectorAll("tr");
      rows.forEach((tr, idx) => {
        const start = p * PAGE_SIZE;
        const end   = start + PAGE_SIZE;
        if (idx < start || idx >= end) {
          tr.style.display = "none";
        }
      });

      const pn = clone.querySelector(".page-number");
      if (pn) {
        pn.textContent = `${pagePrefix}${p+1}/${totalPages}`;
      }

      printContainer.appendChild(clone);
    }
  }

  function cleanupPrintPages() {
    document.getElementById("printContainer").innerHTML = "";
  }

  // ===============================
  // INIT
  // ===============================
  document.addEventListener("DOMContentLoaded", () => {
    buildItemRows();
    attachRowEvents();
    updateBranchInfo();
    initQuoteMeta();
    loadProducts().then(recalcTotals);

    document.getElementById("branchSelect")
      .addEventListener("change", updateBranchInfo);

    const savedLang = localStorage.getItem("JP_QUO_LANG") || "th";
    switchLanguage(savedLang);
    document.querySelectorAll(".btn-lang").forEach(btn => {
      btn.addEventListener("click", () => switchLanguage(btn.dataset.lang));
    });

    const chkVat = document.getElementById("chkVat");
    if (chkVat) chkVat.addEventListener("change", recalcTotals);

    let buyerEdited = false;
    const custNameInput = document.getElementById("custName");
    const buyerSpan = document.getElementById("buyerName");

    if (custNameInput && buyerSpan) {
      custNameInput.addEventListener("input", () => {
        if (buyerEdited && buyerSpan.textContent.trim() !== "") return;
        buyerSpan.textContent = custNameInput.value;
      });
      buyerSpan.addEventListener("input", () => {
        buyerEdited = buyerSpan.textContent.trim() !== "";
      });
    }

    window.addEventListener("beforeprint", buildPrintPages);
    window.addEventListener("afterprint", cleanupPrintPages);

    const btnReceipt = document.getElementById("btnReceipt");
    if (btnReceipt) {
      btnReceipt.addEventListener("click", (e) => {
        e.preventDefault();
        recalcTotals();
        saveQuotationToStorage();
        window.location.href = "./Receipt%20Form.html";
      });
    }
  });
</script>

</body>
</html>

