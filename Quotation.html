<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ¬∑ JP Medical So Supply</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: "TH SarabunPSK", system-ui, sans-serif;
      margin: 0;
      padding: 8px;
      background: #f5f5f5;
    }
    .page {
      max-width: 1150px;
      margin: 0 auto;
      background: #fff;
      padding: 12px 18px 24px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    /* top bar */
    .top-bar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
      flex-wrap:wrap;
    }
    .btn {
      padding:6px 14px;
      border-radius:30px;
      font-size:0.9rem;
      font-weight:600;
      cursor:pointer;
      border:none;
      color:#fff;
      box-shadow:0 2px 4px rgba(0,0,0,0.2);
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-back    { background:#607d8b; }
    .btn-print   { background:#ff9800; }

    /* language switch */
    .lang-switch {
      display:flex;
      gap:4px;
    }
    .btn-lang {
      border-radius:16px;
      border:1px solid #ccc;
      background:#fff;
      color:#333;
      font-size:0.8rem;
      padding:4px 10px;
      cursor:pointer;
    }
    .btn-lang.active {
      background:#00c853;
      color:#fff;
      border-color:#00c853;
    }

    /* header logo + branch */
    .doc-header {
      display:flex;
      align-items:flex-start;
      gap:16px;
      border:1px solid #000;
      padding:8px 10px;
    }
    .logo-box img {
      max-width:110px;
      height:auto;
    }
    .header-main {
      flex:1;
      text-align:center;
      line-height:1.35;
    }
    .header-main h1 {
      margin:0;
      font-size:1.5rem;
      font-weight:bold;
    }
    .header-main .sub {
      font-size:1.05rem;
    }
    .branch-block {
      text-align:right;
      font-size:0.95rem;
      min-width:230px;
    }
    .branch-line {
      white-space:pre-line;
    }
    .branch-select-row {
      margin-top:4px;
      display:flex;
      justify-content:flex-end;
      gap:4px;
      align-items:center;
      font-size:0.9rem;
    }
    .branch-select-row select {
      font-family:inherit;
      font-size:0.9rem;
      padding:2px 6px;
    }

    /* info rows */
    .info-row {
      display:flex;
      gap:8px;
      margin-top:6px;
    }
    .info-box {
      flex:1;
      border:1px solid #000;
      padding:6px 8px;
      font-size:0.95rem;
    }
    .info-title {
      font-weight:bold;
      margin-bottom:4px;
    }
    .info-grid {
      display:grid;
      grid-template-columns:110px 1fr;
      row-gap:2px;
    }
    .info-grid label {
      display:block;
    }
    .info-grid input {
      width:100%;
      border:none;
      border-bottom:1px dotted #555;
      font-family:inherit;
      font-size:0.95rem;
      padding:0 2px;
      outline:none;
    }

    /* quote meta */
    .meta-grid {
      display:grid;
      grid-template-columns:120px 1fr;
      row-gap:2px;
    }
    .meta-grid input {
      width:100%;
      border:none;
      border-bottom:1px dotted #555;
      font-family:inherit;
      font-size:0.95rem;
      padding:0 2px;
      outline:none;
    }

    /* table */
    .table-wrapper {
      margin-top:8px;
      border:1px solid #000;
      border-top:none;
    }
    table {
      width:100%;
      border-collapse:collapse;
      font-size:0.95rem;
    }
    th, td {
      border:1px solid #000;
      padding:2px 4px;
      vertical-align:top;
    }
    thead th {
      text-align:center;
      background:#00c853;
      color:#fff;
    }
    .number-cell { text-align:center; width:40px; }
    .itemcode-cell { width:130px; }
    .desc-cell   { width:320px; }
    .qty-cell    { width:70px;  text-align:center; }
    .unit-cell   { width:80px;  text-align:center; }
    .price-cell  { width:110px; text-align:right; }
    .amount-cell { width:120px; text-align:right; }

    .cell-input {
      width:100%;
      border:none;
      font-family:inherit;
      font-size:0.95rem;
      padding:0 2px;
      box-sizing:border-box;
      outline:none;
    }
    .cell-input.number { text-align:right; }
    .cell-input.center { text-align:center; }

    /* summary block */
    .summary-row {
      display:flex;
      border-left:1px solid #000;
      border-right:1px solid #000;
      border-bottom:1px solid #000;
    }
    .summary-left {
      flex:1;
      border-right:1px solid #000;
      min-height:90px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.2rem;
    }
    .summary-left span[contenteditable] {
      border-bottom:1px dotted #555;
      padding:0 4px;
      min-width:120px;
      display:inline-block;
      text-align:center;
    }
    .summary-right {
      width:230px;
    }
    .summary-right table {
      width:100%;
      border-collapse:collapse;
      font-size:0.95rem;
    }
    .summary-right td {
      border-left:1px solid #000;
      border-right:1px solid #000;
      border-bottom:1px solid #000;
      padding:2px 4px;
    }
    .summary-right .label { width:55%; }
    .summary-right .value { width:45%; text-align:right; }
    .summary-right input {
      border:none;
      width:100%;
      text-align:right;
      font-family:inherit;
      font-size:0.95rem;
      outline:none;
    }

    .vat-toggle-row {
      text-align:right;
      font-size:0.85rem;
      margin-bottom:2px;
    }

    /* footer sign */
    .footer-block {
      border:1px solid #000;
      border-top:none;
      padding:8px 10px 12px;
      font-size:0.95rem;
      display:grid;
      grid-template-columns:1.4fr 1fr;
      gap:8px;
    }
    .footer-left {
      border-right:1px solid #000;
      padding-right:10px;
    }
    .footer-left p { margin:2px 0; }
    .footer-sign-row {
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
    }
    .sign-box { flex:1; text-align:center; }
    .sign-line {
      border-bottom:1px solid #000;
      height:26px;
      margin-bottom:2px;
    }
    .footer-right {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:space-between;
      text-align:center;
      gap:6px;
    }
    .footer-right img {
      max-width:120px;
      height:auto;
    }
    .footer-note {
      font-size:0.8rem;
      color:#555;
    }

    /* editable buyer name */
    #buyerName {
      min-width:120px;
      display:inline-block;
      text-align:center;
      outline:none;
    }

    .status-text {
      font-size:0.8rem;
      color:#777;
      margin-top:4px;
    }

    .page-number {
      margin-top:4px;
      text-align:right;
      font-size:0.85rem;
    }

    /* print container */
    #printContainer {
      display:none;
    }

    @media print {
      body { background:#fff; padding:0; }
      #editPage { display:none; }
      #printContainer { display:block; }
      .top-bar { display:none; }
      .page { box-shadow:none; margin:0; padding:0 5mm 5mm; }
      .print-page { page-break-after:always; }
      .print-page:last-child { page-break-after:auto; }
      @page { size:A4 portrait; margin:5mm; }

      /* ‡∏ã‡πà‡∏≠‡∏ô placeholder ‡πÄ‡∏ß‡∏•‡∏≤ print / PDF */
      input::placeholder {
        color: transparent;
      }
    }
  </style>
</head>
<body>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏£‡∏¥‡∏á -->
<div class="page" id="editPage">

  <div class="top-bar">
    <a href="./ky9.html" class="btn btn-back" data-i18n="btn_back_ky9">‚Üê ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏Ç‡∏¢.9)</a>

    <div class="lang-switch">
      <button type="button" class="btn-lang" data-lang="th">TH</button>
      <button type="button" class="btn-lang" data-lang="en">EN</button>
    </div>

    <button class="btn btn-print" onclick="window.print()">üñ® <span data-i18n="btn_print">‡∏û‡∏¥‡∏°‡∏û‡πå / PDF</span></button>
  </div>

  <!-- HEADER -->
  <div class="doc-header">
    <div class="logo-box">
      <img src="./LOGO.jpg" alt="JP Medical So Supply Logo">
    </div>
    <div class="header-main">
      <h1 data-i18n="title_quotation">QUOTATION</h1>
      <div class="sub" data-i18n="subtitle_quotation">‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</div>
    </div>
    <div class="branch-block">
      <div><strong>‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå JP Medical So Supply</strong></div>
      <div id="branchInfo" class="branch-line"></div>
      <div class="branch-select-row">
        <label for="branchSelect" data-i18n="label_branch">‡∏™‡∏≤‡∏Ç‡∏≤:</label>
        <select id="branchSelect">
          <option value="ssk" data-i18n="branch_ssk">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà (‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©)</option>
          <option value="chon" data-i18n="branch_chon">‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ</option>
        </select>
      </div>
    </div>
  </div>

  <!-- CUSTOMER + META -->
  <div class="info-row">
    <div class="info-box">
      <div class="info-title" data-i18n="box_customer">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Customer)</div>
      <div class="info-grid">
        <label data-i18n="label_customer_name">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö:</label>
        <input id="custName" type="text" />
        <label data-i18n="label_org">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏£‡πâ‡∏≤‡∏ô:</label>
        <input id="custOrg" type="text" />
        <label data-i18n="label_address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</label>
        <input id="custAddr" type="text" />
        <label data-i18n="label_tel">‡πÇ‡∏ó‡∏£:</label>
        <input id="custTel" type="text" />
      </div>
    </div>
    <div class="info-box">
      <div class="info-title" data-i18n="box_quote_detail">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</div>
      <div class="meta-grid">
        <label data-i18n="label_quote_no">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤:</label>
        <input id="quoteNo" type="text" />
        <label data-i18n="label_quote_date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
        <input id="quoteDate" type="text" />
        <label data-i18n="label_valid_until">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
        <input id="validUntil" type="text" />
        <label data-i18n="label_contact">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</label>
        <input id="contactName" type="text" />
        <label data-i18n="label_contact_tel">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</label>
        <input id="contactTel" type="text" />
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-wrapper">
    <table>
      <thead>
      <tr>
        <th class="number-cell" data-i18n="th_no">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
        <th class="itemcode-cell" data-i18n="th_itemcode">Item Code</th>
        <th class="desc-cell" data-i18n="th_desc">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
        <th class="qty-cell" data-i18n="th_qty">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
        <th class="unit-cell" data-i18n="th_unit">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th class="price-cell" data-i18n="th_price">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th class="amount-cell" data-i18n="th_amount">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
      </tr>
      </thead>
      <tbody id="itemBody"></tbody>
    </table>
  </div>

  <!-- SUMMARY -->
  <div class="summary-row">
    <div class="summary-left">
      <span data-i18n="summary_amount_words">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£):</span>
      &nbsp;
      <span id="amountWords" contenteditable="true">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô</span>
    </div>
    <div class="summary-right">
      <div class="vat-toggle-row">
        <label>
          <input type="checkbox" id="chkVat" checked>
          <span data-i18n="vat_toggle_label">‡∏Ñ‡∏¥‡∏î‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° 7%</span>
        </label>
      </div>
      <table>
        <tr>
          <td class="label" data-i18n="summary_subtotal">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td>
          <td class="value">
            <input id="sumSubTotal" type="text" value="0.00" readonly>
          </td>
        </tr>
        <tr>
          <td class="label" data-i18n="summary_discount">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td>
          <td class="value">
            <input id="sumDiscount" type="text" value="0.00">
          </td>
        </tr>
        <tr>
          <td class="label" data-i18n="summary_vat">‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° 7.00%</td>
          <td class="value">
            <input id="sumVat" type="text" value="0.00" readonly>
          </td>
        </tr>
        <tr>
          <td class="label" data-i18n="summary_deposit">‡∏´‡∏±‡∏Å ‡∏°‡∏±‡∏î‡∏à‡∏≥/‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</td>
          <td class="value">
            <input id="sumDeposit" type="text" value="0.00">
          </td>
        </tr>
        <tr>
          <td class="label"><strong data-i18n="summary_grand">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</strong></td>
          <td class="value">
            <input id="sumGrand" type="text" value="0.00" readonly>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer-block">
    <div class="footer-left">
      <p data-i18n="sign_please_th">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ</p>
      <p data-i18n="sign_please_en">Please sign below purchasing confirmation.</p>

      <div class="footer-sign-row">
        <div class="sign-box">
          <div class="sign-line"></div>
          ( <span id="buyerName" contenteditable="true"></span> )<br>
          <span data-i18n="label_buyer">‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</span>
        </div>
        <div class="sign-box">
          <div class="sign-line"></div>
          ( ‡∏û‡∏±‡∏í‡∏ô‡πå‡∏ô‡∏£‡∏µ ‡πÇ‡∏û‡∏ò‡∏¥‡∏£‡∏±‡∏ï‡∏ô‡πå )<br>
          <span data-i18n="label_prepared_by">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ / Prepared by</span>
        </div>
      </div>
    </div>
    <div class="footer-right">
      <div data-i18n="respectfully">
        ‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏∑‡∏≠<br>JP Medical So Supply
      </div>
      <img src="./ORCODE%20OFFice.png" alt="Line QR">
      <div class="footer-note" data-i18n="footer_note">
        ‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå / ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°
      </div>
    </div>
  </div>

  <div id="status" class="status-text">
    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏à‡∏≤‡∏Å Google Sheet‚Ä¶
  </div>

  <div class="page-number"></div>
</div>

<!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤ -->
<div id="printContainer"></div>

<!-- datalist ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
<datalist id="productList"></datalist>

<script>
  // ===== CONFIG =====
  const PRODUCT_SHEET_ID = "1U4d5PqBMQ1GfTahwvbvzDFQrEikT5sYCOwZIx8FabMI";
  const PRODUCT_GID = "942187814";
  const PRODUCT_URL =
    `https://docs.google.com/spreadsheets/d/${PRODUCT_SHEET_ID}/gviz/tq?tqx=out:json&gid=${PRODUCT_GID}`;

  const MAX_ROWS = 30;   // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏ö‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
  const PAGE_SIZE = 10;  // 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå
  const VAT_RATE = 0.07;

  let products = [];
  let currentLang = "th";

  // ===== I18N =====
  const I18N = {
    th: {
      btn_back_ky9: "‚Üê ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏Ç‡∏¢.9)",
      btn_print: "‡∏û‡∏¥‡∏°‡∏û‡πå / PDF",
      title_quotation: "QUOTATION",
      subtitle_quotation: "‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤",
      label_branch: "‡∏™‡∏≤‡∏Ç‡∏≤:",
      branch_ssk: "‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà (‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©)",
      branch_chon: "‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ",
      box_customer: "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Customer)",
      label_customer_name: "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö:",
      label_org: "‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏£‡πâ‡∏≤‡∏ô:",
      label_address: "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:",
      label_tel: "‡πÇ‡∏ó‡∏£:",
      box_quote_detail: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤",
      label_quote_no: "‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤:",
      label_quote_date: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:",
      label_valid_until: "‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:",
      label_contact: "‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:",
      label_contact_tel: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:",
      th_no: "‡∏•‡∏≥‡∏î‡∏±‡∏ö",
      th_itemcode: "Item Code",
      th_desc: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤",
      th_qty: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô",
      th_unit: "‡∏´‡∏ô‡πà‡∏ß‡∏¢",
      th_price: "‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢",
      th_amount: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô",
      summary_amount_words: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£):",
      vat_toggle_label: "‡∏Ñ‡∏¥‡∏î‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° 7%",
      summary_subtotal: "‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô",
      summary_discount: "‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î",
      summary_vat: "‡∏†‡∏≤‡∏©‡∏µ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏° 7.00%",
      summary_deposit: "‡∏´‡∏±‡∏Å ‡∏°‡∏±‡∏î‡∏à‡∏≥/‡∏≠‡∏∑‡πà‡∏ô ‡πÜ",
      summary_grand: "‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠",
      sign_please_th: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ã‡πá‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ",
      sign_please_en: "Please sign below purchasing confirmation.",
      label_buyer: "‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠",
      label_prepared_by: "‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ / Prepared by",
      respectfully: "‡∏Ç‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏±‡∏ö‡∏ñ‡∏∑‡∏≠<br>JP Medical So Supply",
      footer_note: "‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå / ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°",
      page_prefix: "‡∏´‡∏ô‡πâ‡∏≤ "
    },
    en: {
      btn_back_ky9: "‚Üê KY9 Document",
      btn_print: "Print / PDF",
      title_quotation: "QUOTATION",
      subtitle_quotation: "Quotation",
      label_branch: "Branch:",
      branch_ssk: "Head Office (Sisaket)",
      branch_chon: "Chonburi Branch",
      box_customer: "To (Customer)",
      label_customer_name: "Attention:",
      label_org: "Company / Shop:",
      label_address: "Address:",
      label_tel: "Tel:",
      box_quote_detail: "Quotation Details",
      label_quote_no: "Quotation No.:",
      label_quote_date: "Date:",
      label_valid_until: "Valid until:",
      label_contact: "Contact person:",
      label_contact_tel: "Phone:",
      th_no: "No.",
      th_itemcode: "Item Code",
      th_desc: "Description",
      th_qty: "Qty",
      th_unit: "Unit",
      th_price: "Unit price",
      th_amount: "Amount",
      summary_amount_words: "Amount in words:",
      vat_toggle_label: "Apply VAT 7%",
      summary_subtotal: "Sub total",
      summary_discount: "Discount",
      summary_vat: "VAT 7.00%",
      summary_deposit: "Deposit / Others",
      summary_grand: "Total due",
      sign_please_th: "Please sign below purchasing confirmation.",
      sign_please_en: "",
      label_buyer: "Buyer",
      label_prepared_by: "Prepared by",
      respectfully: "Yours faithfully<br>JP Medical So Supply",
      footer_note: "Scan QR to add Line / Contact us",
      page_prefix: "Page "
    }
  };

  function switchLanguage(lang) {
    currentLang = lang;
    const dict = I18N[lang] || I18N.th;
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      if (dict[key] !== undefined) {
        // ‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏°‡∏µ HTML ‡πÄ‡∏ä‡πà‡∏ô <br>
        if (key === "respectfully") {
          el.innerHTML = dict[key];
        } else {
          el.textContent = dict[key];
        }
      }
    });
    document.querySelectorAll(".btn-lang").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.lang === lang);
    });
    localStorage.setItem("JP_QUO_LANG", lang);
  }

  // ===== INITIAL UI BUILD =====
  function buildItemRows() {
    const tbody = document.getElementById("itemBody");
    tbody.innerHTML = "";
    for (let i = 0; i < MAX_ROWS; i++) {
      const tr = document.createElement("tr");
      tr.setAttribute("data-row", i);
      tr.innerHTML = `
        <td class="number-cell">
          <input class="cell-input center" id="idx_${i}" type="text" value="${i+1}">
        </td>
        <td class="itemcode-cell">
          <input class="cell-input" id="code_${i}" type="text">
        </td>
        <td class="desc-cell">
          <input class="cell-input" id="desc_${i}" list="productList"
                 placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏°‡∏ß‡∏î / ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤">
        </td>
        <td class="qty-cell">
          <input class="cell-input center" id="qty_${i}" type="number" min="0" step="1" value="">
        </td>
        <td class="unit-cell">
          <input class="cell-input center" id="unit_${i}" type="text">
        </td>
        <td class="price-cell">
          <input class="cell-input number" id="price_${i}" type="number" step="0.01">
        </td>
        <td class="amount-cell">
          <input class="cell-input number" id="amount_${i}" type="number" step="0.01" readonly>
        </td>
      `;
      tbody.appendChild(tr);
    }
  }

  // ===== BRANCH INFO =====
  function updateBranchInfo() {
    const val = document.getElementById("branchSelect").value;
    const el = document.getElementById("branchInfo");

    if (val === "chon") {
      el.textContent =
        "‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡πÄ‡∏à‡∏û‡∏µ ‡πÄ‡∏°‡∏î‡∏¥‡∏Ñ‡∏≠‡∏• ‡πÇ‡∏ã ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢ (‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ)\n" +
        "‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 51/49 ‡∏ñ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó ‡∏´‡∏°‡∏π‡πà 4 ‡∏ï‡∏≥‡∏ö‡∏•‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏ß‡∏ô ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ 20000\n" +
        "‡πÇ‡∏ó‡∏£ 090-413-7894, 090-967-4207";
    } else {
      el.textContent =
        "‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡πÄ‡∏à‡∏û‡∏µ ‡πÄ‡∏°‡∏î‡∏¥‡∏Ñ‡∏≠‡∏• ‡πÇ‡∏ã ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢ (‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà)\n" +
        "‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 871/1 ‡∏ñ‡∏ô‡∏ô‡∏≠‡∏∏‡∏ö‡∏• ‡∏ï‡∏≥‡∏ö‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÉ‡∏ï‡πâ ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏© 33000\n" +
        "‡πÇ‡∏ó‡∏£ 090-413-7894, 090-967-4207";
    }
  }

  // ===== QUOTE META AUTO FILL =====
  function initQuoteMeta() {
    let seq = parseInt(localStorage.getItem("JP_QUO_SEQ") || "0", 10);
    seq++;
    localStorage.setItem("JP_QUO_SEQ", String(seq).padStart(4,"0"));
    const seqStr = String(seq).padStart(4,"0");

    const today = new Date();
    const valid = new Date(today.getTime() + 30*24*60*60*1000);

    function fmt(d) {
      const dd = String(d.getDate()).padStart(2,"0");
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const yy = d.getFullYear()+543; // ‡∏û.‡∏®.
      return `${dd}/${mm}/${yy}`;
    }

    document.getElementById("quoteNo").value = `QT-${seqStr}`;
    document.getElementById("quoteDate").value = fmt(today);
    document.getElementById("validUntil").value = fmt(valid);
    document.getElementById("contactName").value = "‡∏Ñ‡∏∏‡∏ì‡∏û‡∏±‡∏í‡∏ô‡πå‡∏ô‡∏£‡∏µ";
    document.getElementById("contactTel").value = "090-413-7894, 090-967-4207";
  }

  // ===== FETCH PRODUCTS FROM SHEET =====
  async function loadProducts() {
    const status = document.getElementById("status");
    try {
      const res = await fetch(PRODUCT_URL);
      const text = await res.text();
      const jsonStr = text.substring(text.indexOf("{"), text.lastIndexOf("}") + 1);
      const data = JSON.parse(jsonStr);

      const rows = data.table.rows || [];
      products = rows.map(r => {
        const c = r.c || [];
        return {
          itemCode: c[0]?.v ?? "",
          productName: c[1]?.v ?? "",
          category: c[2]?.v ?? "",
          unit: c[3]?.v ?? "",
          cost: Number(c[5]?.v ?? 0)
        };
      }).filter(p => p.itemCode || p.productName);

      buildProductDatalist();
      status.textContent = `‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß ${products.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚Ä¢ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡∏°‡∏ß‡∏î / ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÑ‡∏î‡πâ`;
    } catch (e) {
      console.error(e);
      status.textContent = "‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚Äì ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï (‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠‡πÑ‡∏î‡πâ)";
    }
  }

  function buildProductDatalist() {
    const dl = document.getElementById("productList");
    dl.innerHTML = "";
    products.forEach(p => {
      const opt = document.createElement("option");
      const label =
        `${p.category || ""} ¬∑ ${p.productName || ""} ¬∑ (${p.itemCode || ""})`;
      opt.value = label;
      dl.appendChild(opt);
    });
  }

  // ===== ROW HANDLERS =====
  function attachRowEvents() {
    for (let i = 0; i < MAX_ROWS; i++) {
      const desc  = document.getElementById(`desc_${i}`);
      const code  = document.getElementById(`code_${i}`);
      const qty   = document.getElementById(`qty_${i}`);
      const price = document.getElementById(`price_${i}`);

      desc.addEventListener("change", () => handleDescSelect(i));
      code.addEventListener("change", () => handleCodeInput(i));

      qty.addEventListener("input", () => { updateRowAmount(i); recalcTotals(); });
      price.addEventListener("input", () => { updateRowAmount(i); recalcTotals(); });
    }

    document.getElementById("sumDiscount").addEventListener("input", recalcTotals);
    document.getElementById("sumDeposit").addEventListener("input", recalcTotals);
  }

  function findProductByCode(code) {
    return products.find(p => (p.itemCode || "").trim() === code.trim());
  }

  function handleDescSelect(row) {
    const descInput = document.getElementById(`desc_${row}`);
    const text = descInput.value || "";
    const m = text.match(/\(([^()]+)\)\s*$/);
    if (m) {
      const code = m[1].trim();
      fillRowByCode(row, code);
    }
  }

  function handleCodeInput(row) {
    const codeInput = document.getElementById(`code_${row}`);
    const code = codeInput.value || "";
    if (code) fillRowByCode(row, code);
  }

  function fillRowByCode(row, code) {
    const p = findProductByCode(code);
    if (!p) return;

    document.getElementById(`code_${row}`).value = p.itemCode || "";
    document.getElementById(`desc_${row}`).value = p.productName || "";
    document.getElementById(`unit_${row}`).value = p.unit || "";
    document.getElementById(`price_${row}`).value =
      p.cost ? p.cost.toFixed(2) : "";

    const qtyInput = document.getElementById(`qty_${row}`);
    if (!qtyInput.value) qtyInput.value = "1";

    updateRowAmount(row);
    recalcTotals();
  }

  function updateRowAmount(row) {
    const qty   = parseFloat(document.getElementById(`qty_${row}`).value || "0");
    const price = parseFloat(document.getElementById(`price_${row}`).value || "0");
    const amt   = qty * price;
    document.getElementById(`amount_${row}`).value =
      amt ? amt.toFixed(2) : "";
  }

  // ===== TOTALS & THAI TEXT =====
  function parseMoney(str) {
    const n = parseFloat((str || "0").toString().replace(/,/g,""));
    return isNaN(n) ? 0 : n;
  }

  function recalcTotals() {
    let sub = 0;
    for (let i = 0; i < MAX_ROWS; i++) {
      const amt = parseMoney(document.getElementById(`amount_${i}`).value);
      sub += amt;
    }

    const discount = parseMoney(document.getElementById("sumDiscount").value);
    const deposit  = parseMoney(document.getElementById("sumDeposit").value);
    const useVat   = document.getElementById("chkVat")?.checked ?? true;

    const afterDiscount = sub - discount;
    const vat = useVat ? afterDiscount * VAT_RATE : 0;
    const grand = afterDiscount + vat - deposit;

    document.getElementById("sumSubTotal").value = sub.toFixed(2);
    document.getElementById("sumVat").value       = vat.toFixed(2);
    document.getElementById("sumGrand").value     = grand.toFixed(2);

    document.getElementById("amountWords").textContent =
      numberToThaiBahtText(grand);
  }

  function numberToThaiBahtText(amount) {
    amount = parseFloat(amount);
    if (isNaN(amount) || amount === 0) return "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";

    const thNum = ["‡∏®‡∏π‡∏ô‡∏¢‡πå","‡∏´‡∏ô‡∏∂‡πà‡∏á","‡∏™‡∏≠‡∏á","‡∏™‡∏≤‡∏°","‡∏™‡∏µ‡πà","‡∏´‡πâ‡∏≤","‡∏´‡∏Å","‡πÄ‡∏à‡πá‡∏î","‡πÅ‡∏õ‡∏î","‡πÄ‡∏Å‡πâ‡∏≤"];
    const thUnit = ["","‡∏™‡∏¥‡∏ö","‡∏£‡πâ‡∏≠‡∏¢","‡∏û‡∏±‡∏ô","‡∏´‡∏°‡∏∑‡πà‡∏ô","‡πÅ‡∏™‡∏ô","‡∏•‡πâ‡∏≤‡∏ô"];

    function readNumber(numStr) {
      numStr = numStr.replace(/^0+/,"");
      if (numStr === "") return "";
      if (numStr.length > 6) {
        const head = numStr.slice(0, numStr.length - 6);
        const tail = numStr.slice(-6);
        return readNumber(head) + "‡∏•‡πâ‡∏≤‡∏ô" + readNumber(tail);
      }
      let result = "";
      const digits = numStr.split("").map(d => parseInt(d,10));
      const len = digits.length;
      for (let i = 0; i < len; i++) {
        const d = digits[i];
        const pos = len - i - 1;
        if (d === 0) continue;
        if (pos === 0) {
          if (d === 1 && len > 1) result += "‡πÄ‡∏≠‡πá‡∏î";
          else result += thNum[d];
        } else if (pos === 1) {
          if (d === 1) result += "‡∏™‡∏¥‡∏ö";
          else if (d === 2) result += "‡∏¢‡∏µ‡πà‡∏™‡∏¥‡∏ö";
          else result += thNum[d] + "‡∏™‡∏¥‡∏ö";
        } else {
          result += thNum[d] + thUnit[pos];
        }
      }
      return result;
    }

    const fixed = amount.toFixed(2);
    const [bahtStr, satangStr] = fixed.split(".");
    let text = "";
    const bahtNum = parseInt(bahtStr,10);
    const satangNum = parseInt(satangStr,10);

    if (bahtNum > 0) text += readNumber(bahtStr) + "‡∏ö‡∏≤‡∏ó";
    if (satangNum === 0) text += "‡∏ñ‡πâ‡∏ß‡∏ô";
    else text += readNumber(satangStr) + "‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå";
    return text;
  }

  // ===== MULTI-PAGE PRINT =====
  function syncInputAttributes() {
    // ‡πÉ‡∏´‡πâ clone ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ value ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å
    document.querySelectorAll("#editPage input").forEach(inp => {
      inp.setAttribute("value", inp.value);
    });
  }

  function buildPrintPages() {
    recalcTotals();            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    syncInputAttributes();     // sync value -> attribute

    const printContainer = document.getElementById("printContainer");
    printContainer.innerHTML = "";

    const editPage = document.getElementById("editPage");
    if (!editPage) return;

    // ‡∏´‡∏≤ row ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
    let lastRow = -1;
    for (let i = 0; i < MAX_ROWS; i++) {
      const code = (document.getElementById(`code_${i}`).value || "").trim();
      const desc = (document.getElementById(`desc_${i}`).value || "").trim();
      const amt  = (document.getElementById(`amount_${i}`).value || "").trim();
      if (code || desc || amt) lastRow = i;
    }
    if (lastRow < 0) lastRow = 0;

    const totalItems = lastRow + 1;
    const totalPages = Math.max(1, Math.ceil(totalItems / PAGE_SIZE));
    const dict = I18N[currentLang] || I18N.th;
    const pagePrefix = dict.page_prefix || "";

    for (let p = 0; p < totalPages; p++) {
      const clone = editPage.cloneNode(true);
      clone.id = "";
      clone.classList.add("print-page");

      // ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
      const tbody = clone.querySelector("#itemBody");
      const rows = tbody.querySelectorAll("tr");
      rows.forEach((tr, idx) => {
        const start = p * PAGE_SIZE;
        const end   = start + PAGE_SIZE;
        if (idx < start || idx >= end) {
          tr.style.display = "none";
        }
      });

      // ‡πÉ‡∏™‡πà‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤
      const pn = clone.querySelector(".page-number");
      if (pn) {
        pn.textContent = `${pagePrefix}${p+1}/${totalPages}`;
      }

      printContainer.appendChild(clone);
    }
  }

  function cleanupPrintPages() {
    document.getElementById("printContainer").innerHTML = "";
  }

  // ===== INIT =====
  document.addEventListener("DOMContentLoaded", () => {
    buildItemRows();
    attachRowEvents();
    updateBranchInfo();
    initQuoteMeta();
    loadProducts().then(() => {
      recalcTotals();
    });

    document.getElementById("branchSelect")
      .addEventListener("change", updateBranchInfo);

    // language
    const savedLang = localStorage.getItem("JP_QUO_LANG") || "th";
    switchLanguage(savedLang);
    document.querySelectorAll(".btn-lang").forEach(btn => {
      btn.addEventListener("click", () => {
        switchLanguage(btn.dataset.lang);
      });
    });

    // VAT toggle
    const chkVat = document.getElementById("chkVat");
    if (chkVat) {
      chkVat.addEventListener("change", recalcTotals);
    }

    // AUTO FILL ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö" ‡πÅ‡∏ï‡πà‡πÅ‡∏Å‡πâ‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ
    let buyerEdited = false;
    const custNameInput = document.getElementById("custName");
    const buyerSpan = document.getElementById("buyerName");

    if (custNameInput && buyerSpan) {
      custNameInput.addEventListener("input", () => {
        if (buyerEdited && buyerSpan.textContent.trim() !== "") return;
        buyerSpan.textContent = custNameInput.value;
      });

      buyerSpan.addEventListener("input", () => {
        buyerEdited = buyerSpan.textContent.trim() !== "";
      });
    }

    // multi-page print hooks
    window.addEventListener("beforeprint", buildPrintPages);
    window.addEventListener("afterprint", cleanupPrintPages);
  });
</script>
</body>
</html>

