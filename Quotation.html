<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ ¬∑ JP Medical So Supply</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
/* -------- STYLE ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö 100%) -------- */

body {
  font-family: "TH SarabunPSK", system-ui, sans-serif;
  margin: 0;
  padding: 8px;
  background: #f5f5f5;
}

.page {
  max-width: 1150px;
  margin: 0 auto;
  background: #fff;
  padding: 12px 18px 24px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

/* top bar */
.top-bar {
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  margin-bottom:8px;
  flex-wrap:wrap;
}
.btn {
  padding:6px 14px;
  border-radius:30px;
  font-size:0.9rem;
  font-weight:600;
  cursor:pointer;
  border:none;
  color:#fff;
  box-shadow:0 2px 4px rgba(0,0,0,0.2);
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  gap:6px;
}
.btn-back    { background:#607d8b; }
.btn-print   { background:#ff9800; }
.btn-receipt { background:#4caf50; }

/* language switch */
.lang-switch {
  display:flex;
  gap:4px;
}
.btn-lang {
  border-radius:16px;
  border:1px solid #ccc;
  background:#fff;
  color:#333;
  font-size:0.8rem;
  padding:4px 10px;
  cursor:pointer;
}
.btn-lang.active {
  background:#00c853;
  color:#fff;
  border-color:#00c853;
}

/* header */
.doc-header {
  display:flex;
  align-items:flex-start;
  gap:16px;
  border:1px solid #000;
  padding:8px 10px;
}
.logo-box img {
  max-width:110px;
}
.header-main {
  flex:1; text-align:center; line-height:1.35;
}
.header-main h1 { margin:0; font-size:1.5rem; font-weight:bold; }
.branch-block { text-align:right; font-size:0.95rem; min-width:230px; }
.branch-line { white-space:pre-line; }

.branch-select-row {
  margin-top:4px;
  display:flex;
  justify-content:flex-end;
  gap:4px;
  align-items:center;
  font-size:0.9rem;
}

.info-row { display:flex; gap:8px; margin-top:6px; }
.info-box {
  flex:1; border:1px solid #000; padding:6px 8px; font-size:0.95rem;
}
.info-title { font-weight:bold; margin-bottom:4px; }
.info-grid {
  display:grid;
  grid-template-columns:110px 1fr;
  row-gap:2px;
}
.info-grid input {
  width:100%; border:none; border-bottom:1px dotted #555;
  font-family:inherit; font-size:0.95rem; padding:0 2px;
}

/* TABLE */
.table-wrapper {
  margin-top:8px;
  border:1px solid #000;
  border-top:none;
}
table { width:100%; border-collapse:collapse; font-size:0.95rem; }
th, td { border:1px solid #000; padding:2px 4px; vertical-align:top; }
thead th {
  text-align:center;
  background:#00c853;
  color:#fff;
}

.number-cell { width:40px; text-align:center; }
.itemcode-cell { width:130px; }
.desc-cell { width:320px; }
.qty-cell { width:70px; text-align:center; }
.unit-cell { width:80px; text-align:center; }
.price-cell, .amount-cell { width:120px; text-align:right; }

.cell-input {
  width:100%;
  border:none;
  padding:0 2px;
  font-size:0.95rem;
  box-sizing:border-box;
}
.cell-input.center { text-align:center; }
.cell-input.number { text-align:right; }

/* PRINT VERSION (‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) */
.desc-print {
  display:none;
  white-space:normal;
  line-height:1.1;
  max-height:2.4em;
  overflow:hidden;
}

/* SUMMARY */
.summary-row {
  display:flex;
  border-left:1px solid #000;
  border-right:1px solid #000;
  border-bottom:1px solid #000;
}
.summary-left {
  flex:1;
  border-right:1px solid #000;
  min-height:90px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.summary-right { width:230px; }

/* print */
@media print {
  body { background:#fff; padding:0; }
  #editPage { display:none; }
  #printContainer { display:block; }
  .page { box-shadow:none; padding:0; margin:0; }
}
</style>
</head>

<body>

<!-- --------------------------------------------------- -->
<!-- PAGE FORM -->
<!-- --------------------------------------------------- -->
<div class="page" id="editPage">

  <div class="top-bar">
    <a href="./ky9.html" class="btn btn-back">‚Üê ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡∏Ç‡∏¢.9)</a>

    <div class="lang-switch">
      <button type="button" class="btn-lang" data-lang="th">TH</button>
      <button type="button" class="btn-lang" data-lang="en">EN</button>
    </div>

    <a href="./Receipt%20Form.html" id="btnReceipt" class="btn btn-receipt">üßæ ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</a>

    <button class="btn btn-print" onclick="window.print()">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå / PDF</button>
  </div>

  <!-- HEADER -->
  <div class="doc-header">
    <div class="logo-box">
      <img src="./LOGO.jpg" />
    </div>

    <div class="header-main">
      <h1>QUOTATION</h1>
      <div class="sub">‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</div>
    </div>

    <div class="branch-block">
      <div><strong>‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå JP Medical So Supply</strong></div>
      <div id="branchInfo" class="branch-line"></div>

      <div class="branch-select-row">
        <label>‡∏™‡∏≤‡∏Ç‡∏≤:</label>
        <select id="branchSelect">
          <option value="ssk">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà (‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©)</option>
          <option value="chon">‡∏™‡∏≤‡∏Ç‡∏≤‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ</option>
        </select>
      </div>
    </div>
  </div>

  <!-- CUSTOMER & META -->
  <div class="info-row">
    <div class="info-box">
      <div class="info-title">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Customer)</div>
      <div class="info-grid">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö:</label>
        <input id="custName" type="text">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô / ‡∏£‡πâ‡∏≤‡∏ô:</label>
        <input id="custOrg">
        <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</label>
        <input id="custAddr">
        <label>‡πÇ‡∏ó‡∏£:</label>
        <input id="custTel">
      </div>
    </div>

    <div class="info-box">
      <div class="info-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤</div>
      <div class="info-grid">
        <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤:</label>
        <input id="quoteNo">
        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
        <input id="quoteDate">
        <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á:</label>
        <input id="validUntil">
        <label>‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</label>
        <input id="contactName">
        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</label>
        <input id="contactTel">
      </div>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-wrapper">
    <table>
      <thead>
      <tr>
        <th class="number-cell">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
        <th class="itemcode-cell">Item Code</th>
        <th class="desc-cell">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
        <th class="qty-cell">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
        <th class="unit-cell">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th class="price-cell">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th class="amount-cell">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
      </tr>
      </thead>
      <tbody id="itemBody"></tbody>
    </table>
  </div>

  <!-- SUMMARY -->
  <div class="summary-row">
    <div class="summary-left">
      ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£): &nbsp;
      <span id="amountWords" contenteditable="true">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô</span>
    </div>

    <div class="summary-right">
      <table>
        <tr>
          <td>‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</td>
          <td><input id="sumSubTotal" readonly></td>
        </tr>
        <tr>
          <td>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</td>
          <td><input id="sumDiscount"></td>
        </tr>
        <tr>
          <td>VAT 7%</td>
          <td><input id="sumVat" readonly></td>
        </tr>
        <tr>
          <td>‡∏´‡∏±‡∏Å‡∏°‡∏±‡∏î‡∏à‡∏≥</td>
          <td><input id="sumDeposit"></td>
        </tr>
        <tr>
          <td><b>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</b></td>
          <td><input id="sumGrand" readonly></td>
        </tr>
      </table>
    </div>
  </div>

</div>

<div id="printContainer"></div>
<datalist id="productList"></datalist>

<!-- --------------------------------------------------- -->
<!-- SCRIPT ‡∏£‡∏ß‡∏°‡πÄ‡∏ï‡πá‡∏° (‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö 100%) -->
<!-- --------------------------------------------------- -->
<script>
/* SCRIPT ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (PART 2‚Äì4 ‡∏£‡∏ß‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß) */
/* ---------------- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô + I18N + ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ + ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì + ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤ ---------------- */

const PRODUCT_SHEET_ID = "1U4d5PqBMQ1GfTahwvbvzDFQrEikT5sYCOwZIx8FabMI";
const PRODUCT_GID = "942187814";
const PRODUCT_URL =
`https://docs.google.com/spreadsheets/d/${PRODUCT_SHEET_ID}/gviz/tq?tqx=out:json&gid=${PRODUCT_GID}`;

const MAX_ROWS = 30;
const STORAGE_KEY = "JP_LAST_QUOTATION";

let products = [];

function updateBranchInfo(){
  const val = document.getElementById("branchSelect").value;
  const el = document.getElementById("branchInfo");

  if(val==="chon"){
    el.textContent =
`‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå JP Medical So Supply (‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ)
51/49 ‡∏ñ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó ‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏ß‡∏ô ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à.‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ 20000
‡πÇ‡∏ó‡∏£ 090-413-7894, 090-967-4207`;
  } else {
    el.textContent =
`‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå JP Medical So Supply (‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà)
871/1 ‡∏ñ‡∏ô‡∏ô‡∏≠‡∏∏‡∏ö‡∏• ‡∏ï.‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÉ‡∏ï‡πâ ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à.‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏© 33000
‡πÇ‡∏ó‡∏£ 090-413-7894, 090-967-4207`;
  }
}

function buildItemRows(){
  const tbody = document.getElementById("itemBody");
  tbody.innerHTML = "";
  for(let i=0;i<MAX_ROWS;i++){
    tbody.innerHTML += `
      <tr>
        <td><input id="idx_${i}" class="cell-input center" value="${i+1}"></td>
        <td><input id="code_${i}" class="cell-input"></td>
        <td>
          <input id="desc_${i}" class="cell-input" list="productList">
          <div id="desc_print_${i}" class="desc-print"></div>
        </td>
        <td><input id="qty_${i}" class="cell-input center"></td>
        <td><input id="unit_${i}" class="cell-input center"></td>
        <td><input id="price_${i}" class="cell-input number"></td>
        <td><input id="amount_${i}" class="cell-input number" readonly></td>
      </tr>`;
  }
}

function loadProducts(){
  return fetch(PRODUCT_URL)
  .then(r=>r.text())
  .then(txt=>{
    const json = JSON.parse(txt.substring(txt.indexOf("{"), txt.lastIndexOf("}")+1));
    products = json.table.rows.map(r=>{
      const c = r.c;
      return {
        itemCode: c[0]?.v ?? "",
        productName: c[1]?.v ?? "",
        category: c[2]?.v ?? "",
        unit: c[3]?.v ?? "",
        price: Number(c[6]?.v ?? 0)
      };
    });
    const dl = document.getElementById("productList");
    dl.innerHTML = "";
    products.forEach(p=>{
      dl.innerHTML += `<option value="${p.category} ¬∑ ${p.productName} ¬∑ (${p.itemCode})">`;
    });
  });
}

function parseMoney(s){
  return parseFloat((s||"0").replace(/,/g,""))||0;
}
function formatMoney(n){
  return (n||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});
}

function updateAmount(i){
  const qty = parseMoney(document.getElementById(`qty_${i}`).value);
  const price = parseMoney(document.getElementById(`price_${i}`).value);
  document.getElementById(`amount_${i}`).value = formatMoney(qty*price);
  recalcTotals();
}

function recalcTotals(){
  let total = 0;
  for(let i=0;i<MAX_ROWS;i++){
    total += parseMoney(document.getElementById(`amount_${i}`).value);
  }
  const disc = parseMoney(sumDiscount.value);
  const dep  = parseMoney(sumDeposit.value);
  const vat  = (total-disc)*0.07;
  const grand = total-disc+vat-dep;

  sumSubTotal.value = formatMoney(total);
  sumVat.value = formatMoney(vat);
  sumGrand.value = formatMoney(grand);
}

/* INIT */
document.addEventListener("DOMContentLoaded",()=>{
  updateBranchInfo();
  document.getElementById("branchSelect").addEventListener("change",updateBranchInfo);

  buildItemRows();
  loadProducts();

  for(let i=0;i<MAX_ROWS;i++){
    ["qty","price"].forEach(f=>{
      document.getElementById(`${f}_${i}`).addEventListener("input",()=>updateAmount(i));
    });
  }
});

</script>

</body>
</html>
